#!/usr/bin/env node
var debug = require('debug')('MetroGraph');
var app = require('../app');
var http = require('http');
var fs = require('fs');
var tr = require('../metro-graph');
var Adapter = require('../fetch-adapters/yadapter');

app.set('port', process.env.PORT || 3000);

var server = http.createServer(app);
server.listen(app.get('port'), function () {
    debug('Express server listening on port ' + server.address().port);
    console.info('server started');
    var url = 'https://maps.yandex.ru/export/usermaps/geSTNBuviAaKSWp8lkQE4G7Oha2K8cUr.kml';
    var adapter = new Adapter(url);
    adapter.parseFile().then(graph => {
        var json = graph.toJSON();
        fs.writeFile('./json/graph.json', json, 'utf8', err => {
            if (err) throw err;
            console.time('recreation takes');
            const mg = new tr.MetroGraph(json);
            console.timeEnd('recreation takes');
        });
    }).catch(err => console.error(err));
});
//var server = app.listen(app.get('port'), function() {
//  debug('Express server listening on port ' + server.address().port);
//});//


