!function t(e,n,r){function o(a,s){if(!n[a]){if(!e[a]){var u="function"==typeof require&&require;if(!s&&u)return u(a,!0);if(i)return i(a,!0);var c=new Error("Cannot find module '"+a+"'");throw c.code="MODULE_NOT_FOUND",c}var l=n[a]={exports:{}};e[a][0].call(l.exports,function(t){var n=e[a][1][t];return o(n?n:t)},l,l.exports,t,e,n,r)}return n[a].exports}for(var i="function"==typeof require&&require,a=0;a<r.length;a++)o(r[a]);return o}({1:[function(t,e,n){function r(){l=!1,s.length?c=s.concat(c):f=-1,c.length&&o()}function o(){if(!l){var t=setTimeout(r);l=!0;for(var e=c.length;e;){for(s=c,c=[];++f<e;)s&&s[f].run();f=-1,e=c.length}s=null,l=!1,clearTimeout(t)}}function i(t,e){this.fun=t,this.array=e}function a(){}var s,u=e.exports={},c=[],l=!1,f=-1;u.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)e[n-1]=arguments[n];c.push(new i(t,e)),1!==c.length||l||setTimeout(o,0)},i.prototype.run=function(){this.fun.apply(null,this.array)},u.title="browser",u.browser=!0,u.env={},u.argv=[],u.version="",u.versions={},u.on=a,u.addListener=a,u.once=a,u.off=a,u.removeListener=a,u.removeAllListeners=a,u.emit=a,u.binding=function(t){throw new Error("process.binding is not supported")},u.cwd=function(){return"/"},u.chdir=function(t){throw new Error("process.chdir is not supported")},u.umask=function(){return 0}},{}],2:[function(t,e,n){"use strict";function r(t,e){if(e.length<1)throw new Error("an objects array must contain at least 1 object");for(var n=e[0],r=t.distanceTo(n.location),o=1;o<e.length;++o){var i=t.distanceTo(e[o].location);r>i&&(n=e[o],r=i)}return n}function o(t,e,n,r){void 0===r&&(r=!1);var o=e.filter(function(e){return t.distanceTo(e.location)<=n});return r&&o.sort(function(e,n){return t.distanceTo(e.location)-t.distanceTo(n.location)}),o}function i(t){for(var e=0,n=0,r=0;r<t.length;++r)e+=t[r].lat,n+=t[r].lng;return new a.LatLng(e/t.length,n/t.length)}var a=window.L;n.findClosestObject=r,n.findObjectsWithinRadius=o,n.getCenter=i},{}],3:[function(t,e,n){var r=(this&&this.__awaiter||function(t,e,n,r){return new n(function(o,i){function a(t){return t instanceof n&&t.constructor===n?t:new n(function(e){e(t)})}function s(t){try{c("next",t)}catch(e){i(e)}}function u(t){try{c("throw",t)}catch(e){i(e)}}function c(t,e){var n=r[t](e);n.done?o(n.value):a(n.value).then(s,u)}r=r.call(t,e),c("next",void 0)})},window.L),o=function(){function t(t,e){void 0===e&&(e=null),this.layerControl=r.control.UniForm(t,e,{collapsed:!1,position:"topright"})}return t.prototype.addTo=function(t){this.layerControl.addTo(t),this.layerControl.renderUniformControl()},t}();n.LayerControl=o;var i=function(){function t(t){var e=t.getOverlay(),n=t.getMap(),o=new r.Polyline([],{color:"red"});o.addTo(n);var i=new r.CircleMarker([60,30]);e.addEventListener("click",function(t){if(t.shiftKey){var e=n.containerPointToLatLng(new r.Point(t.x,t.y));o.addLatLng(e).redraw(),i.on("mouseout",function(t){return i.closePopup()}),i.addTo(n);var a=o.getLatLngs();if(a.length>1){for(var s=0,u=1;u<a.length;++u)s+=a[u-1].distanceTo(a[u]);r.popup().setLatLng(e).setContent("Popup").openOn(n)}}})}return t}();n.Measurement=i},{}],4:[function(t,e,n){function r(t,e){var n=this,r=[t.source,t.target],o=["source","target"];o.forEach(function(s,u){Object.defineProperty(t,s,{get:function(){return t["_"+s]},set:function(r){var c=document.getElementById("p-"+r),l=Number(c.getAttribute("r"))/2+parseFloat(getComputedStyle(c).getPropertyValue("stroke-width")),f=n.platformsOnSVG[r];if("line"===e[0].tagName){for(var p=u+1,h=n.platformsOnSVG[t[o[1-u]]],d=0;d<e.length;d++){var m=e[d];m.setAttribute("x"+p,f.x.toString()),m.setAttribute("y"+p,f.y.toString())}var g=document.getElementById("g-"+n.graph.transfers.indexOf(t)),y="source"===s?h.subtract(f):f.subtract(h);i.setGradientDirection(g,y);var v=l/f.distanceTo(h);i.setGradientOffset(g,v)}else{if("path"!==e[0].tagName)throw new Error("wrong element type for transfer");for(var _=[],b=[],x=0;x<n.graph.transfers.length;++x){var w=n.graph.transfers[x];if((w.source===t.source||w.target===t.target||w.source===t.target||w.target===t.source)&&(_.push(w),b.push(x),3===_.length))break}for(var S=new Set,O=0;O<_.length;O++){var j=_[O];S.add(j.source).add(j.target)}if(3!==S.size){var k=n.graph.platforms[_[0].source].name;throw new Error("circle size is "+S.size+": "+k)}var E=[];S.forEach(function(t){return E.push(n.platformsOnSVG[t])});for(var L=a.getCircumcenter(E),P=b.map(function(t){return document.getElementById("ot-"+t)}),T=b.map(function(t){return document.getElementById("it-"+t)}),x=0;3>x;++x){var j=_[x],C=P[x],M=T[x],A=n.platformsOnSVG[j.source],B=n.platformsOnSVG[j.target];i.setCircularPath(C,L,A,B),M.setAttribute("d",C.getAttribute("d"));var g=document.getElementById("g-"+b[x]);i.setGradientDirection(g,B.subtract(A));var v=l/A.distanceTo(B);i.setGradientOffset(g,v)}}}}),t["_"+s]=r[u]})}function o(t,e){var n=this,r="number"==typeof t?[t,this.graph.platforms[t]]:[this.graph.platforms.indexOf(t),t],o=r[0],a=r[1],s=a.location;Object.defineProperty(a,"location",{get:function(){return a._location},set:function(t){a._location=t;for(var r=n.map.getZoom()<12?n.graph.stations[a.station].location:t,s=n.map.latLngToContainerPoint(r).subtract(n.map.latLngToContainerPoint(n.bounds.getNorthWest())),u=0;u<e.length;u++){var c=e[u];c.setAttribute("cx",s.x.toString()),c.setAttribute("cy",s.y.toString())}n.whiskers[o]=n.makeWhiskers(o),n.platformsOnSVG[o]=s;for(var l=new Set(a.spans),f=0,p=a.spans;f<p.length;f++){var h=p[f],d=n.graph.spans[h],m=d.source,g=d.target,y=o===m?g:m;n.whiskers[y]=n.makeWhiskers(y),n.graph.platforms[y].spans.forEach(function(t){return l.add(t)})}l.forEach(function(t){var e=n.graph.spans[t],r=e.source,o=e.target,a=[n.platformsOnSVG[r],n.whiskers[r][t],n.whiskers[o][t],n.platformsOnSVG[o]];i.setBezierPath(document.getElementById("op-"+t),a);var s=document.getElementById("ip-"+t);s&&i.setBezierPath(s,a)}),n.graph.transfers.filter(function(t){return t.source===o||t.target===o}).forEach(function(t){return t[o===t.source?"source":"target"]=o})}}),a._location=s}var i=(this&&this.__awaiter||function(t,e,n,r){return new n(function(o,i){function a(t){return t instanceof n&&t.constructor===n?t:new n(function(e){e(t)})}function s(t){try{c("next",t)}catch(e){i(e)}}function u(t){try{c("throw",t)}catch(e){i(e)}}function c(t,e){var n=r[t](e);n.done?o(n.value):a(n.value).then(s,u)}r=r.call(t,e),c("next",void 0)})},t("./svg")),a=t("../util");n.transferToModel=r,n.platformToModel=o},{"../util":67,"./svg":10}],5:[function(t,e,n){var r=(this&&this.__awaiter||function(t,e,n,r){return new n(function(o,i){function a(t){return t instanceof n&&t.constructor===n?t:new n(function(e){e(t)})}function s(t){try{c("next",t)}catch(e){i(e)}}function u(t){try{c("throw",t)}catch(e){i(e)}}function c(t,e){var n=r[t](e);n.done?o(n.value):a(n.value).then(s,u)}r=r.call(t,e),c("next",void 0)})},t("../util")),o=r.getUserLanguage();"ru"!==o&&"fi"!==o&&(o="en");var i={fromclick:{ru:"Otśuda",fi:"Tältä",en:"From here"},toclick:{ru:"Śuda",fi:"Tänne",en:"To here"},clearroute:{ru:"Očistiť maršrut",fi:"Tyhjennä reitti",en:"Clear route"}},a=function(){function t(t){var e=this;this.metroMap=t,t.getOverlay().addEventListener("contextmenu",function(n){n.preventDefault();var r,a=new L.Point(n.clientX,n.clientY);return e.state?r=document.getElementById("contextmenu"):(r=document.createElement("table"),Object.keys(i).forEach(function(t,e){var n=r.insertRow(e),a=n.insertCell(0);a.setAttribute("data-event",t),a.textContent=i[t][o]}),r.onclick=function(r){var o=r.target,i={clientX:n.clientX,clientY:n.clientY};t.dispatchEvent(new MouseEvent(o.getAttribute("data-event"),i)),e.state=!1},r.id="contextmenu",r.style.position="absolute",document.body.appendChild(r),e.state=!0),r.style.left=a.x+"px",r.style.top=a.y+"px",!1}),t.getOverlay().addEventListener("click",function(t){2!==t.button&&(e.state=!1)})}return Object.defineProperty(t.prototype,"state",{get:function(){return null!==document.getElementById("contextmenu")},set:function(t){t||document.body.removeChild(document.getElementById("contextmenu"))},enumerable:!0,configurable:!0}),t}();Object.defineProperty(n,"__esModule",{value:!0}),n["default"]=a},{"../util":67}],6:[function(t,e,n){var r=(this&&this.__awaiter||function(t,e,n,r){return new n(function(o,i){function a(t){return t instanceof n&&t.constructor===n?t:new n(function(e){e(t)})}function s(t){try{c("next",t)}catch(e){i(e)}}function u(t){try{c("throw",t)}catch(e){i(e)}}function c(t,e){var n=r[t](e);n.done?o(n.value):a(n.value).then(s,u)}r=r.call(t,e),c("next",void 0)})},t("./metro-map")),o=t("../util");L.Browser.ie?alert("Does not work in IE (yet)"):L.Browser.mobile&&alert("May work incorrectly in mobile browser");var i=t("./polyfills");i["default"]();var a=t("./tilelayers");new r["default"]("map-container","json/graph.json",a["default"]);o.flashTitle(["Plan metro Sankt-Peterburga","Pietarin metron hankesuunnitelma","St Petersburg metro plan proposal"],3e3),console.log("user: "+navigator.userLanguage),console.log("language: "+navigator.language),console.log("browser: "+navigator.browserLanguage),console.log("system: "+navigator.systemLanguage)},{"../util":67,"./metro-map":8,"./polyfills":9,"./tilelayers":12}],7:[function(t,e,n){var r=(this&&this.__awaiter||function(t,e,n,r){return new n(function(o,i){function a(t){return t instanceof n&&t.constructor===n?t:new n(function(e){e(t)})}function s(t){try{c("next",t)}catch(e){i(e)}}function u(t){try{c("throw",t)}catch(e){i(e)}}function c(t,e){var n=r[t](e);n.done?o(n.value):a(n.value).then(s,u)}r=r.call(t,e),c("next",void 0)})},t("../util")),o=t("./svg"),i=function(){function t(t){this.metroMap=t,document.getElementById("edit-map-button").addEventListener("click",this.editMapClick.bind(this))}return t.prototype.editMapClick=function(t){var e=this.metroMap.getMap(),n=this.metroMap.getPlate(),i=this.metroMap.getGraph(),a=t.target,s=["Edit Map","Save Map"],u=document.getElementById("dummy-circles");if(a.textContent===s[0])u.onmousedown=function(t){if(0===t.button){var r=o.platformByCircle(t.target,i);e.dragging.disable(),e.on("mousemove",function(t){r.location=t.latlng,n.disabled=!0}),e.once("mouseup",function(t){e.off("mousemove").dragging.enable(),n.disabled=!1,n.show(o.circleByDummy(t.originalEvent.target))})}else if(1===t.button){var r=o.platformByCircle(t.target,i),a=r.name,s=r.altNames.fi,u=r.altNames.en;n.show(o.circleByDummy(t.target));var c=u?[a,s,u]:s?[a,s]:[a];l=prompt("New name",c.join("|")).split("|"),r.name=l[0],r.altNames.fi=l[1],r.altNames.en=l[2]}var l},a.textContent=s[1];else{if(a.textContent!==s[1])throw new Error("Incorrect button text");var c=JSON.stringify(i,function(t,e){return t.startsWith("_")?void 0:e});r.downloadAsFile("graph.json",c),u.onmousedown=u.onclick=null,a.textContent=s[0]}},t}();Object.defineProperty(n,"__esModule",{value:!0}),n["default"]=i},{"../util":67,"./svg":10}],8:[function(t,e,n){var r=(this&&this.__awaiter||function(t,e,n,r){return new n(function(o,i){function a(t){return t instanceof n&&t.constructor===n?t:new n(function(e){e(t)})}function s(t){try{c("next",t)}catch(e){i(e)}}function u(t){try{c("throw",t)}catch(e){i(e)}}function c(t,e){var n=r[t](e);n.done?o(n.value):a(n.value).then(s,u)}r=r.call(t,e),c("next",void 0)})},window.L),o=t("./svg"),i=t("../util"),a=t("./addons"),s=t("../geo"),u=t("./bind"),c=t("./mapeditor"),l=t("./textplate"),f=t("./contextmenu"),p=function(){function t(t,e,n){var o=this;this.whiskers=[],this.fromMarker=new r.Marker([0,0]),this.toMarker=new r.Marker([0,0]);var s=window.fetch,u=s(e).then(function(t){return t.json()}).then(function(t){return o.graph=t}),l=s("json/hints.json").then(function(t){return t.json()}).then(function(t){return o.hints=t}),p=s("json/data.json").then(function(t){return t.json()}).then(function(t){return o.textData=t});this.map=new r.Map(t,{center:new r.LatLng(59.943556,30.30452),zoom:r.Browser.retina?12:11,minZoom:9,inertia:!1}).addControl(new r.Control.Scale({imperial:!1})),console.log(n[Object.keys(n)[0]][0]),n[Object.keys(n)[0]].addTo(this.map),new a.LayerControl(n).addTo(this.map),console.log("map should be created by now"),this.overlay=document.getElementById("overlay");var h=this.map.getContainer();h.removeChild(this.overlay),h.appendChild(this.overlay),this.addMapListeners(),u["catch"](function(t){return alert(t)}).then(function(t){return o.extendBounds()}).then(function(){return l}).then(function(t){return o.redrawNetwork()}).then(function(){return o.map.invalidateSize(!1)}).then(function(){return o.resetMapView()}).then(function(){return o.fixFontRendering(o.map.getPanes().mapPane)}).then(function(){return p}).then(function(){return new c["default"](o)}).then(function(){return new f["default"](o)}),Promise.all([u,l]).then(function(t){return i.verifyHints(o.graph,o.hints)}).then(function(t){return console.log(t)})["catch"](function(t){return console.error(t)}),this.map.addLayer(this.fromMarker).addLayer(this.toMarker)}return t.prototype.getMap=function(){return this.map},t.prototype.getOverlay=function(){return this.overlay},t.prototype.getPlate=function(){return this.plate},t.prototype.getGraph=function(){return this.graph},t.prototype.addEventListener=function(t,e){},t.prototype.dispatchEvent=function(t){return"clearroute"===t.type?(this.fromMarker.setLatLng([0,0]),this.toMarker.setLatLng([0,0]),void this.resetStyle()):(this.handleMenuFromTo(t),!1)},t.prototype.removeEventListener=function(t,e){},t.prototype.resetStyle=function(){for(var t="#paths-inner *, #paths-outer *, #transfers-inner *, #transfers-outer *, #station-circles *",e=document.querySelectorAll(t),n=0;n<e.length;++n)e[n].style.opacity=null,e[n].removeAttribute("filter")},t.prototype.handleMenuFromTo=function(t){var e=new r.Point(t.clientX,t.clientY),n=this.map.getContainer().getBoundingClientRect(),o=new r.Point(n.left,n.top),i=this.map.containerPointToLatLng(e.subtract(o));console.log(i);var a="fromclick"===t.type?this.fromMarker:this.toMarker;a.setLatLng(i),console.log(this.fromMarker,this.toMarker);var s=new r.LatLng(0,0);this.fromMarker.getLatLng().equals(s)||this.toMarker.getLatLng().equals(s)||this.visualizeShortestPath(this.fromMarker.getLatLng(),this.toMarker.getLatLng())},t.prototype.addMapListeners=function(){var t=this,e=this.map.getPanes().mapPane;this.map.on("movestart",function(e){console.log("move start"),t.map.touchZoom.disable(),r.Browser.webkit&&o.removeGradients()}).on("move",function(n){t.overlay.style.transform=e.style.transform}).on("moveend",function(n){console.log("move ended"),t.map.touchZoom.enable(),r.Browser.webkit&&o.addGradients(),t.fixFontRendering(e)}).on("zoomstart",function(e){t.map.dragging.disable(),console.log(e),t.overlay.style.opacity="0.5"}).on("zoomend",function(e){console.log(e),console.log("zoom ended"),t.redrawNetwork(),t.overlay.style.opacity=null,t.map.dragging.enable()})},t.prototype.fixFontRendering=function(t){var e=i.parseTransform(t.style.transform);this.overlay.style.transform=t.style.transform="translate("+e.x+"px, "+e.y+"px)"},t.prototype.resetMapView=function(){this.map.setView(this.bounds.getCenter(),r.Browser.retina?12:11,{pan:{animate:!1},zoom:{animate:!1}})},t.prototype.resetOverlayStructure=function(){for(var t;t=this.overlay.firstChild;)this.overlay.removeChild(t);var e=o.createSVGElement("defs");e.appendChild(o.makeDropShadow()),e.appendChild(o.makeShadowGlow()),this.overlay.appendChild(e);var n=o.createSVGElement("g");n.id="origin";for(var r=0,i=["paths-outer","paths-inner","transfers-outer","station-circles","transfers-inner","dummy-circles"];r<i.length;r++){var a=i[r],s=o.createSVGElement("g");s.id=a,n.appendChild(s)}this.overlay.appendChild(n),this.plate=new l["default"](this.graph),n.insertBefore(this.plate.element,document.getElementById("dummy-circles"))},t.prototype.extendBounds=function(){var t=this,e=this.graph.platforms[0].location;this.bounds=new r.LatLngBounds(e,e),this.graph.platforms.forEach(function(e){return t.bounds.extend(e.location)})},t.prototype.addBindings=function(){for(var t=this.graph.platforms,e=0;e<t.length;++e){var n=document.getElementById("p-"+e),r=document.getElementById("d-"+e);u.platformToModel.call(this,e,[n,r])}},t.prototype.posOnSVG=function(t,e){var n=this.map.latLngToContainerPoint(e);return n.subtract(t.min)},t.prototype.updateOverlayPositioning=function(){var t=this.bounds.getNorthWest(),e=this.bounds.getSouthEast(),n=new r.Bounds(this.map.latLngToContainerPoint(t),this.map.latLngToContainerPoint(e)),o=i.parseTransform(this.overlay.style.transform),a=n.getSize(),s=n.min.subtract(o).subtract(a);this.overlay.style.left=s.x+"px",this.overlay.style.top=s.y+"px";var u=a,c=document.getElementById("origin");c.style.transform="translate("+u.x+"px, "+u.y+"px)";var l=a.multiplyBy(3);this.overlay.style.width=l.x+"px",this.overlay.style.height=l.y+"px"},t.prototype.redrawNetwork=function(){var t=this;this.fromMarker.setLatLng([0,0]),this.toMarker.setLatLng([0,0]),this.resetOverlayStructure(),this.updateOverlayPositioning();var e={"station-circles":document.createDocumentFragment(),"dummy-circles":document.createDocumentFragment(),"paths-inner":document.createDocumentFragment(),"paths-outer":document.createDocumentFragment(),"transfers-inner":document.createDocumentFragment(),"transfers-outer":document.createDocumentFragment()},n=this.map.getZoom(),a=this.bounds.getNorthWest(),s=this.bounds.getSouthEast(),c=new r.Bounds(this.map.latLngToContainerPoint(a),this.map.latLngToContainerPoint(s));document.getElementById("edit-map-button").disabled=12>n;var l=12>n?function(e){return t.posOnSVG(c,t.graph.stations[e.station].location)}:function(e){return t.posOnSVG(c,e.location)};this.platformsOnSVG=this.graph.platforms.map(l);var f=.5*(n-7),p=12>n?1.25*f:f,h=12>n?.4*p:.6*p,d=.9*f,m=1.25*h;r.Browser.retina&&(it=[f,p,h,d].map(function(t){return 1.5*t}),f=it[0],p=it[1],h=it[2],d=it[3]),document.getElementById("station-circles").style.strokeWidth=h+"px",document.getElementById("transfers-outer").style.strokeWidth=d+m/2+"px",document.getElementById("transfers-inner").style.strokeWidth=d-m/2+"px",document.getElementById("paths-outer").style.strokeWidth=f+"px",document.getElementById("paths-inner").style.strokeWidth=f/2+"px";for(var g=new Set,y=new Map,v=0;v<this.graph.stations.length;++v){for(var _=this.graph.stations[v],b=[],x=0,w=_.platforms;x<w.length;x++){var S=w[x],O=this.graph.platforms[S],j=this.platformsOnSVG[S];if(n>9){var k=o.makeCircle(j,p);if(k.id="p-"+S,n>11){for(var E=new Set,L=0,P=O.spans;L<P.length;L++)for(var T=P[L],C=0,M=this.graph.spans[T].routes;C<M.length;C++){var A=M[C];E.add(this.graph.routes[A].line)}if(1===E.size){var B=E.values().next().value.match(/([MEL])(\d{0,2})/);B&&k.classList.add("M"===B[1]?B[0]:B[1]+"-line")}}var I=o.makeCircle(j,2*p);I.id="d-"+S,e["station-circles"].appendChild(k),e["dummy-circles"].appendChild(I)}this.whiskers[S]=this.makeWhiskers(S)}var G=document.getElementById("dummy-circles");G.addEventListener("mouseover",function(e){return t.plate.show(o.circleByDummy(e.target))}),G.addEventListener("mouseout",function(e){return t.plate.hide()});for(var N=i.findCircle(this.graph,_),D=0,z=_.platforms;D<z.length;D++){var S=z[D],O=this.graph.platforms[S];N&&N.indexOf(O)>-1&&(b.push(this.platformsOnSVG[S]),g.add(S))}if(N&&3===N.length){var V=i.getCircumcenter(b);y.set(v,V)}}if(n>11)for(var F=0;F<this.graph.transfers.length;++F){var R=this.graph.transfers[F],W=void 0,U=this.graph.platforms[R.source],q=this.graph.platforms[R.target],H=this.platformsOnSVG[R.source],Y=this.platformsOnSVG[R.target];if(g.has(R.source)&&g.has(R.target)){var Z=y.get(U.station);W=o.makeTransferArc(Z,H,Y)}else H.x===Y.x?Y.x+=.01:H.y===Y.y&&(Y.y+=.01),W=o.makeTransfer(H,Y);W[0].id="ot-"+F,W[1].id="it-"+F;var X=[U,q].map(function(e){var n=t.graph.spans[e.spans[0]],r=n.routes.map(function(e){return t.graph.routes[e]}),o=r[0].line.match(/([MEL])(\d{0,2})/),a=o[0],s=o[1];o[2];return i.lineRules["L"===s?s:a]}),K=(p+h/2)/H.distanceTo(Y),J=o.makeGradient(Y.subtract(H),X,K);J.id="g-"+F;var Q=document.getElementsByTagName("defs")[0];Q.appendChild(J),W[0].style.stroke="url(#"+J.id+")",e["transfers-outer"].appendChild(W[0]),e["transfers-inner"].appendChild(W[1]),u.transferToModel.call(this,R,W)}for(var $=0;$<this.graph.spans.length;++$){var tt=this.makePath($),et=tt[0],nt=tt[1];e["paths-outer"].appendChild(et),nt?e["paths-inner"].appendChild(nt):this.graph.routes[this.graph.spans[$].routes[0]].line.startsWith("L")&&(et.style.strokeWidth=.75*f+"px")}for(var rt=0,ot=Object.keys(e);rt<ot.length;rt++){var $=ot[rt];document.getElementById($).appendChild(e[$])}this.addBindings();var it},t.prototype.makeWhiskers=function(t){var e=this,n=this.graph.platforms[t],r=this.platformsOnSVG[t];if(n.spans.length<2)return z={},z[n.spans[0]]=r,z;if(n.spans.length>2){var o=[[],[]],a=[[],[]],s=this.hints.crossPlatform,u=i.hintContainsLine(this.graph,s,n);if(n.name in s&&null!==u){for(var c=u>-1?s[n.name][u]:s[n.name],l=[],f=0,p=Object.keys(c);f<p.length;f++){var h=p[f],d=c[h];"string"==typeof d?l.push(d):l.push.apply(l,d)}for(var m=0,g=n.spans;m<g.length;m++){var y=g[m],v=this.graph.spans[y],_=v.source===t?v.target:v.source,b=this.graph.platforms[_],x=this.platformsOnSVG[_],w=l.indexOf(b.name)>-1?1:0;o[w].push(x),a[w].push(y)}}var S=o.map(function(t){return r.add(1===t.length?t[0]:0===t.length?r:i.getCenter(t)).divideBy(2)}),O=S.map(function(t){return r.distanceTo(t)}),j=S[1].subtract(S[0]).multiplyBy(O[0]/(O[0]+O[1])),k=S[0].add(j),E=r.subtract(k),L={};return a[0].forEach(function(t){return L[t]=S[0].add(E)}),a[1].forEach(function(t){return L[t]=S[1].add(E)}),L}var P=n.spans.map(function(t){return e.graph.routes[e.graph.spans[t].routes[0]].line});if(P[0]!==P[1])return V={},V[n.spans[0]]=r,V[n.spans[1]]=r,V;var T=[r,r],C=[0,0],M=this.graph.spans[n.spans[0]];M.source===t&&n.spans.reverse();for(var A=0;2>A;++A){var v=this.graph.spans[n.spans[A]],B=v.source===t?v.target:v.source,I=this.platformsOnSVG[B];C[A]=r.distanceTo(I),T[A]=r.add(I).divideBy(2)}var G=T[1].subtract(T[0]).multiplyBy(C[0]/(C[0]+C[1])),N=T[0].add(G),D=r.subtract(N);return F={},F[n.spans[0]]=T[0].add(D),F[n.spans[1]]=T[1].add(D),F;var z,V,F},t.prototype.makePath=function(t){var e=this,n=this.graph.spans[t],r=n.source,i=n.target,a=n.routes.map(function(t){return e.graph.routes[t]}),s=a[0].line.match(/([MEL])(\d{0,2})/),u=s[0],c=s[1],l=(s[2],[this.platformsOnSVG[r],this.whiskers[r][t],this.whiskers[i][t],this.platformsOnSVG[i]]),f=o.makeCubicBezier(l);if(f.id="op-"+t,"E"===c){f.classList.add("E");var p=f.cloneNode(!0);return p.id="ip-"+t,[f,p]}return u&&f.classList.add(u),f.classList.add(c+"-line"),[f]},t.prototype.visualizeShortestPath=function(t,e){var n=this;this.resetStyle();for(var i=this.shortestPath(t,e),a=i.platforms,s=i.path,u=i.time,c="#paths-inner *, #paths-outer *, #transfers-inner *, #transfers-outer *, #station-circles *",l=document.querySelectorAll(c),f=0;f<l.length;++f)l[f].style.opacity="0.25";console.log(s),console.log(a.map(function(t){return n.graph.platforms[t].name}));var p=function(t){if(document.getElementById("p-"+a[t]).style.opacity=null,t>=s.length)return alert("time:\n"+Math.round(u.walkTo/60)+" mins on foot\n"+Math.round(u.metro/60)+" mins by metro\n"+Math.round(u.walkFrom/60)+" mins on foot\nTOTAL: "+Math.round(u.total/60)+" mins");var e=document.getElementById("o"+s[t]);if(null===e)return p(t+1);var i=document.getElementById("i"+s[t]),c=e.cloneNode(!0),l=null===i?null:i.cloneNode(!0);document.getElementById("paths-outer").appendChild(c),l&&document.getElementById("paths-inner").appendChild(l);var f=c instanceof SVGLineElement?r.point(Number(c.x1),Number(c.y1)).distanceTo(r.point(Number(c.x2),Number(c.y2))):c.getTotalLength(),h=n.graph.spans[parseInt(s[t].slice(2))];if(h.source!==a[t]){var d=o.getBezierPath(c).reverse();console.log(d),4===d.length&&(o.setBezierPath(c,d),l&&o.setBezierPath(l,d))}var m=f;c.setAttribute("filter","url(#black-glow)");for(var g=0,y=null===l?[c]:[c,l];g<y.length;g++){var v=y[g];v.style.transition=null,v.style.strokeDasharray=f+" "+f,v.style.strokeDashoffset=f.toString(),v.style.opacity=null,v.getBoundingClientRect(),v.style.transition="stroke-dashoffset "+m+"ms linear",v.style.strokeDashoffset="0"}setTimeout(function(){e.style.opacity=null,e.setAttribute("filter","url(#black-glow)"),document.getElementById("paths-outer").removeChild(c),l&&(i.style.opacity=null,i.setAttribute("filter","url(#black-glow)"),l&&document.getElementById("paths-inner").removeChild(l)),p(t+1)},m),console.log(c)};p(0)},t.prototype.shortestPath=function(t,e){for(var n=this,o=this.graph.platforms,a=[],u=[],c=0;c<o.length;c++){var l=o[c],f=r.LatLng.prototype.distanceTo.call(t,l.location),p=f/(1.3*1.4);a.push(p),u.push(r.LatLng.prototype.distanceTo.call(l.location,e)/(1.3*1.4))}for(var h=o.indexOf(s.findClosestObject(t,o)),d=new Set(o.map(function(t,e){return e})),m=o.map(function(t){return null}),g=r.LatLng.prototype.distanceTo.call(t,e)/(1.3*1.4);d.size>0;){var y=1/0;d.forEach(function(t){a[t]<y&&(h=t,y=a[t])});var v=o[h];d["delete"](h);for(var _=[],b=[],x=[],w=0,S=v.spans;w<S.length;w++){var O=S[w],j=this.graph.spans[O],k=h===j.source?j.target:j.source;if(d.has(k)){var E=o[k];_.push(k),b.push(E);var f=r.LatLng.prototype.distanceTo.call(v.location,E.location),L=this.graph.routes[j.routes[0]].line.startsWith("E")?90:45;x.push(i.timeToTravel(f,18,1.4)+L)}}for(var P=this.graph.transfers.map(function(t,e){return e}).filter(function(t){return n.graph.transfers[t].source===h||n.graph.transfers[t].target===h}),T=0;T<P.length;T++){var O=P[T],C=this.graph.transfers[O],k=h===C.source?C.target:C.source;if(d.has(k)){var E=o[k];_.push(k),b.push(E);var f=r.LatLng.prototype.distanceTo.call(v.location,E.location);x.push(f/(1.3*1.4)+60)}}for(var O=0;O<_.length;++O){var k=_[O],M=a[h]+x[O];M<a[k]&&(a[k]=M,m[k]=h)}var A=a[h]+u[h]}for(var B=1/0,O=0;O<a.length;++O){var A=a[O]+u[O];B>A&&(B=A,h=O)}if(B>g)throw alert("walk on foot, lazybag"),new Error("on foot!");var I=[],G=[h];console.log("making path"),console.log(m);for(var N=0;;){var v=o[h];console.log("current",v.name);var D=m[h];if(null===D)break;for(var z="",V=0,F=v.spans;V<F.length;V++){var O=F[V],j=this.graph.spans[O];if(j.source===h&&j.target===D||j.target===h&&j.source===D){z="p-"+O;break}}if(""===z)for(var O=0;O<this.graph.transfers.length;++O){var C=this.graph.transfers[O];if(C.source===h&&C.target===D||C.target===h&&C.source===D){z="t-"+O;break}}if(I.push(z),G.push(D),++N>o.length)throw new Error("overflow!");h=D}console.log("returning"),G.reverse(),I.reverse();var R=u[G[G.length-1]],W=a[G[0]],U=B-R-W;return{platforms:G,path:I,time:{walkTo:W,metro:U,walkFrom:R,total:B}}},t}();Object.defineProperty(n,"__esModule",{value:!0}),n["default"]=p},{"../geo":2,"../util":67,"./addons":3,"./bind":4,"./contextmenu":5,"./mapeditor":7,"./svg":10,"./textplate":11}],9:[function(t,e,n){function r(){"Promise"in window&&"then"in Promise.prototype&&"catch"in Promise.prototype||(console.log("promises not present, using a polyfill"),t("es6-promise").polyfill()),"Set"in window&&"add"in Set.prototype&&"has"in Set.prototype||(console.log("set not present, using a polyfill"),t("es6-set/implement")),"classList"in HTMLElement.prototype||(console.log("classlist not present, using a polyfill"),t("classlist-polyfill")),Array.prototype.find||(Array.prototype.find=function(t){if(null==this)throw new TypeError("Array.prototype.find called on null or undefined");if("function"!=typeof t)throw new TypeError("predicate must be a function");for(var e,n=Object(this),r=n.length>>>0,o=arguments[1],i=0;r>i;i++)if(e=n[i],t.call(o,e,i,n))return e;return void 0})}this&&this.__awaiter||function(t,e,n,r){return new n(function(o,i){function a(t){return t instanceof n&&t.constructor===n?t:new n(function(e){e(t)})}function s(t){try{c("next",t)}catch(e){i(e)}}function u(t){try{c("throw",t)}catch(e){i(e)}}function c(t,e){var n=r[t](e);n.done?o(n.value):a(n.value).then(s,u)}r=r.call(t,e),c("next",void 0)})};Object.defineProperty(n,"__esModule",{value:!0}),n["default"]=r},{"classlist-polyfill":13,"es6-promise":55,"es6-set/implement":56}],10:[function(t,e,n){function r(t){return document.createElementNS("http://www.w3.org/2000/svg",t)}function o(t,e){var n=r("circle");return n.setAttribute("r",e.toString()),n.setAttribute("cy",t.y.toString()),n.setAttribute("cx",t.x.toString()),n}function i(t,e,n){var o=r("path");return u(o,t,e,n),o}function a(t){for(var e,n=[],r=/\D([\d\.]+).*?,.*?([\d\.]+)/g,o=t.getAttribute("d");null!==(e=r.exec(o));)n.push(new S.Point(Number(e[1]),Number(e[2])));return n}function s(t,e){if(4!==e.length)throw new Error("there should be 4 points");var n=(r("path"),["M"].concat(e.map(function(t){return t.x+","+t.y})));n.splice(2,0,"C"),t.setAttribute("d",n.join(" "))}function u(t,e,n,r){var o=e.distanceTo(n),i=n.subtract(e),a=r.subtract(e),s=i.x*a.y-a.x*i.y<0?1:0,u=Math.atan2(n.y-e.y,n.x-e.x),c=Math.atan2(r.y-e.y,r.x-e.x),l=c-u,f=l<=Math.PI||l>-Math.PI?1:0,p=["M",n.x,n.y,"A",o,o,0,s,f,r.x,r.y].join(" ");t.setAttribute("d",p)}function c(t){var e=r("path");return s(e,t),e}function l(t,e){function n(t){for(var n=new Array(t.length-1),r=0;r<n.length;++r)n[0]=t[r].add(t[r+1].subtract(t[r]).multiplyBy(e));return n}var r=new Array(t.length),o=t.slice(0,t.length);do r.push(o[0]),o=n(o);while(o.length>0);return r}function f(t,e){var n=o(t,e),r=n.cloneNode(!0);return[n,r]}function p(t,e,n){var r=i(t,e,n),o=r.cloneNode(!0);return[r,o]}function h(t,e){var n=["transfer-outer","transfer-inner"];return n.map(function(n){var o=r("line");return o.setAttribute("x1",t.x.toString()),o.setAttribute("y1",t.y.toString()),o.setAttribute("x2",e.x.toString()),o.setAttribute("y2",e.y.toString()),o.classList.add(n),o})}function d(){var t=r("filter");return t.id="shadow",t.setAttribute("width","200%"),t.setAttribute("height","200%"),t.innerHTML='\n        <feOffset result="offOut" in="SourceAlpha" dx="0" dy="2" />\n        <feGaussianBlur result="blurOut" in="offOut" stdDeviation="2" />\n        <feBlend in="SourceGraphic" in2="blurOut" mode="normal" />\n    ',t}function m(){var t=r("filter");return t.id="black-glow",t.innerHTML='<feColorMatrix type="matrix" values=\n            "0 0 0 0   0\n             0 0 0 0   0\n             0 0 0 0   0\n             0 0 0 0.3 0"/>\n        <feGaussianBlur stdDeviation="2.5" result="coloredBlur"/>\n        <feMerge>\n            <feMergeNode in="coloredBlur"/>\n            <feMergeNode in="SourceGraphic"/>\n        </feMerge>',t}function g(t,e){var n=O.vectorToGradCoordinates(e);t.setAttribute("x1",50*(1-n.x)+"%"),t.setAttribute("y1",50*(1-n.y)+"%"),t.setAttribute("x2",50*(1+n.x)+"%"),t.setAttribute("y2",50*(1+n.y)+"%")}function y(t,e){t.children[0].setAttribute("offset",e.toString()),t.children[1].setAttribute("offset",(1-e).toString())}function v(t,e,n){void 0===n&&(n=0);var o=r("linearGradient");return g(o,t),o.innerHTML='<stop offset="'+n+'" style="stop-color:'+e[0]+'" />\n      <stop offset="'+(1-n)+'" style="stop-color:'+e[1]+'" />',o}function _(){var t=document.getElementById("transfers-outer").children;if(t)for(var e=0;e<t.length;++e)t[e].style.stroke=null}function b(){var t=document.getElementById("transfers-outer").children;if(t)for(var e=0;e<t.length;++e){var n=t[e];n.style.stroke="url(#g-"+e+")"}}function x(t){return document.getElementById("p-"+t.id.slice(2))}function w(t,e){return e.platforms[parseInt(t.id.slice(2))]}var S=(this&&this.__awaiter||function(t,e,n,r){return new n(function(o,i){function a(t){return t instanceof n&&t.constructor===n?t:new n(function(e){e(t)})}function s(t){try{c("next",t)}catch(e){i(e)}}function u(t){try{c("throw",t)}catch(e){i(e)}}function c(t,e){var n=r[t](e);n.done?o(n.value):a(n.value).then(s,u)}r=r.call(t,e),c("next",void 0)})},window.L),O=t("../util");n.createSVGElement=r,n.makeCircle=o,n.makeArc=i,n.getBezierPath=a,n.setBezierPath=s,n.setCircularPath=u,n.makeCubicBezier=c,n.cutCubicBezier=l,n.makeTransferRing=f,n.makeTransferArc=p,n.makeTransfer=h,n.makeDropShadow=d,n.makeShadowGlow=m,n.setGradientDirection=g,
n.setGradientOffset=y,n.makeGradient=v,n.removeGradients=_,n.addGradients=b,n.circleByDummy=x,n.platformByCircle=w},{"../util":67}],11:[function(t,e,n){var r=(this&&this.__awaiter||function(t,e,n,r){return new n(function(o,i){function a(t){return t instanceof n&&t.constructor===n?t:new n(function(e){e(t)})}function s(t){try{c("next",t)}catch(e){i(e)}}function u(t){try{c("throw",t)}catch(e){i(e)}}function c(t,e){var n=r[t](e);n.done?o(n.value):a(n.value).then(s,u)}r=r.call(t,e),c("next",void 0)})},t("./svg")),o=t("../util"),i=function(){function t(t){this._disabled=!1,this._editable=!1,this.graph=t,this._element=r.createSVGElement("g"),this._element.id="station-plate",this._element.style.display="none",this._element.innerHTML='<line id="pole" class="plate-pole"/>\n            <g>\n                <rect id="plate-box" class="plate-box" filter="url(#shadow)"/>\n                <text id="plate-text" fill="black" class="plate-text"><tspan/><tspan/><tspan/></text>\n            </g>'}return Object.defineProperty(t.prototype,"element",{get:function(){return this._element},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"disabled",{get:function(){return this._disabled},set:function(t){t?this.hide():getSelection().removeAllRanges(),this._disabled=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"editable",{get:function(){return this._editable},set:function(t){for(var e=t?"true":null,n=this._element.children[1].children[1],r=n.children,o=0;o<r.length;++o)r[o].contentEditable=e},enumerable:!0,configurable:!0}),t.prototype.show=function(t){this.disabled||"none"===this._element.style.display&&(this.modify(t),this._element.style.display=null)},t.prototype.hide=function(){this._element.style.display="none"},t.prototype.modify=function(t){var e=new L.Point(Number(t.getAttribute("cx")),Number(t.getAttribute("cy"))),n=Number(t.getAttribute("r")),i=Math.trunc(n),a=this._element.children[0],s=new L.Point(4+i,8+i),u=e.subtract(s);a.setAttribute("x1",e.x.toString()),a.setAttribute("y1",e.y.toString()),a.setAttribute("x2",u.x.toString()),a.setAttribute("y2",u.y.toString());var c=r.platformByCircle(t,this.graph),l=c.name,f=c.altNames.fi,p=c.altNames.en,h=f?"fi"===o.getUserLanguage()?[f,l]:[l,f]:[l];p&&h.push(p),this.modifyBox(u,h)},t.prototype.modifyBox=function(t,e){var n=this._element.children[1].children[0],r=12,o=e.reduce(function(t,e){return t.length<e.length?e:t}),i=new L.Point(10+6*o.length,6+r*e.length);n.setAttribute("width",i.x.toString()),n.setAttribute("height",i.y.toString());var a=t.subtract(i);n.setAttribute("x",a.x.toString()),n.setAttribute("y",a.y.toString());for(var s=this._element.children[1].children[1],u=0;u<e.length;++u){var c=t.subtract(new L.Point(3,i.y-(u+1)*r)),l=s.children[u];l.setAttribute("x",c.x.toString()),l.setAttribute("y",c.y.toString()),l.textContent=e[u]}for(;u<s.children.length;)s.children[u++].textContent=null;try{var f=s.getBBox();n.setAttribute("x",(f.x-3).toString()),n.setAttribute("width",(f.width+6).toString())}catch(p){}},t}();Object.defineProperty(n,"__esModule",{value:!0}),n["default"]=i},{"../util":67,"./svg":10}],12:[function(t,e,n){var r=(this&&this.__awaiter||function(t,e,n,r){return new n(function(o,i){function a(t){return t instanceof n&&t.constructor===n?t:new n(function(e){e(t)})}function s(t){try{c("next",t)}catch(e){i(e)}}function u(t){try{c("throw",t)}catch(e){i(e)}}function c(t,e){var n=r[t](e);n.done?o(n.value):a(n.value).then(s,u)}r=r.call(t,e),c("next",void 0)})},window.L),o={Mapbox:new r.TileLayer("https://{s}.tiles.mapbox.com/v3/inker.mlo91c41/{z}/{x}/{y}.png",{minZoom:9,detectRetina:!0,bounds:null,attribution:'Map data &copy; <a href="https://openstreetmap.org">OpenStreetMap</a> contributors, <a href="https://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery © <a href="https://mapbox.com">Mapbox</a>'}),OpenMapSurfer:new r.TileLayer("http://openmapsurfer.uni-hd.de/tiles/roads/x={x}&y={y}&z={z}",{minZoom:9,detectRetina:!0,attribution:'Imagery from <a href="http://giscience.uni-hd.de/">GIScience Research Group @ University of Heidelberg</a> &mdash; Map data &copy; <a href="https://server.ts.openstreetmap.org/copyright">OpenStreetMap</a>'}),HyddaBase:r.tileLayer("http://{s}.tile.openstreetmap.se/hydda/base/{z}/{x}/{y}.png",{minZoom:9,detectRetina:!0,attribution:'Tiles courtesy of <a href="http://openstreetmap.se/" target="_blank">OpenStreetMap Sweden</a> &mdash; Map data &copy; <a href="http://server.ts.openstreetmap.org/copyright">OpenStreetMap</a>'}),EsriGrey:r.tileLayer("http://server.arcgisonline.com/ArcGIS/rest/services/Canvas/World_Light_Gray_Base/MapServer/tile/{z}/{y}/{x}",{attribution:"Tiles &copy; Esri &mdash; Esri, DeLorme, NAVTEQ",minZoom:9,detectRetina:!0})};Object.defineProperty(n,"__esModule",{value:!0}),n["default"]=o},{}],13:[function(t,e,n){"document"in window.self&&("classList"in document.createElement("_")?!function(){"use strict";var t=document.createElement("_");if(t.classList.add("c1","c2"),!t.classList.contains("c2")){var e=function(t){var e=DOMTokenList.prototype[t];DOMTokenList.prototype[t]=function(t){var n,r=arguments.length;for(n=0;r>n;n++)t=arguments[n],e.call(this,t)}};e("add"),e("remove")}if(t.classList.toggle("c3",!1),t.classList.contains("c3")){var n=DOMTokenList.prototype.toggle;DOMTokenList.prototype.toggle=function(t,e){return 1 in arguments&&!this.contains(t)==!e?e:n.call(this,t)}}t=null}():!function(t){"use strict";if("Element"in t){var e="classList",n="prototype",r=t.Element[n],o=Object,i=String[n].trim||function(){return this.replace(/^\s+|\s+$/g,"")},a=Array[n].indexOf||function(t){for(var e=0,n=this.length;n>e;e++)if(e in this&&this[e]===t)return e;return-1},s=function(t,e){this.name=t,this.code=DOMException[t],this.message=e},u=function(t,e){if(""===e)throw new s("SYNTAX_ERR","An invalid or illegal string was specified");if(/\s/.test(e))throw new s("INVALID_CHARACTER_ERR","String contains an invalid character");return a.call(t,e)},c=function(t){for(var e=i.call(t.getAttribute("class")||""),n=e?e.split(/\s+/):[],r=0,o=n.length;o>r;r++)this.push(n[r]);this._updateClassName=function(){t.setAttribute("class",this.toString())}},l=c[n]=[],f=function(){return new c(this)};if(s[n]=Error[n],l.item=function(t){return this[t]||null},l.contains=function(t){return t+="",-1!==u(this,t)},l.add=function(){var t,e=arguments,n=0,r=e.length,o=!1;do t=e[n]+"",-1===u(this,t)&&(this.push(t),o=!0);while(++n<r);o&&this._updateClassName()},l.remove=function(){var t,e,n=arguments,r=0,o=n.length,i=!1;do for(t=n[r]+"",e=u(this,t);-1!==e;)this.splice(e,1),i=!0,e=u(this,t);while(++r<o);i&&this._updateClassName()},l.toggle=function(t,e){t+="";var n=this.contains(t),r=n?e!==!0&&"remove":e!==!1&&"add";return r&&this[r](t),e===!0||e===!1?e:!n},l.toString=function(){return this.join(" ")},o.defineProperty){var p={get:f,enumerable:!0,configurable:!0};try{o.defineProperty(r,e,p)}catch(h){-2146823252===h.number&&(p.enumerable=!1,o.defineProperty(r,e,p))}}else o[n].__defineGetter__&&r.__defineGetter__(e,f)}}(window.self))},{}],14:[function(t,e,n){"use strict";var r,o=t("es5-ext/object/copy"),i=t("es5-ext/object/map"),a=t("es5-ext/object/valid-callable"),s=t("es5-ext/object/valid-value"),u=Function.prototype.bind,c=Object.defineProperty,l=Object.prototype.hasOwnProperty;r=function(t,e,n){var r,i=s(e)&&a(e.value);return r=o(e),delete r.writable,delete r.value,r.get=function(){return l.call(this,t)?i:(e.value=u.call(i,null==n?this:this[n]),c(this,t,e),this[t])},r},e.exports=function(t){var e=arguments[1];return i(t,function(t,n){return r(n,t,e)})}},{"es5-ext/object/copy":29,"es5-ext/object/map":37,"es5-ext/object/valid-callable":42,"es5-ext/object/valid-value":43}],15:[function(t,e,n){"use strict";var r,o=t("es5-ext/object/assign"),i=t("es5-ext/object/normalize-options"),a=t("es5-ext/object/is-callable"),s=t("es5-ext/string/#/contains");r=e.exports=function(t,e){var n,r,a,u,c;return arguments.length<2||"string"!=typeof t?(u=e,e=t,t=null):u=arguments[2],null==t?(n=a=!0,r=!1):(n=s.call(t,"c"),r=s.call(t,"e"),a=s.call(t,"w")),c={value:e,configurable:n,enumerable:r,writable:a},u?o(i(u),c):c},r.gs=function(t,e,n){var r,u,c,l;return"string"!=typeof t?(c=n,n=e,e=t,t=null):c=arguments[3],null==e?e=void 0:a(e)?null==n?n=void 0:a(n)||(c=n,n=void 0):(c=e,e=n=void 0),null==t?(r=!0,u=!1):(r=s.call(t,"c"),u=s.call(t,"e")),l={get:e,set:n,configurable:r,enumerable:u},c?o(i(c),l):l}},{"es5-ext/object/assign":26,"es5-ext/object/is-callable":32,"es5-ext/object/normalize-options":38,"es5-ext/string/#/contains":44}],16:[function(t,e,n){"use strict";var r=t("../../object/valid-value");e.exports=function(){return r(this).length=0,this}},{"../../object/valid-value":43}],17:[function(t,e,n){"use strict";var r=t("../../number/to-pos-integer"),o=t("../../object/valid-value"),i=Array.prototype.indexOf,a=Object.prototype.hasOwnProperty,s=Math.abs,u=Math.floor;e.exports=function(t){var e,n,c,l;if(t===t)return i.apply(this,arguments);for(n=r(o(this).length),c=arguments[1],c=isNaN(c)?0:c>=0?u(c):r(this.length)-u(s(c)),e=c;n>e;++e)if(a.call(this,e)&&(l=this[e],l!==l))return e;return-1}},{"../../number/to-pos-integer":24,"../../object/valid-value":43}],18:[function(t,e,n){"use strict";var r=Object.prototype.toString,o=r.call(function(){return arguments}());e.exports=function(t){return r.call(t)===o}},{}],19:[function(t,e,n){"use strict";e.exports=new Function("return this")()},{}],20:[function(t,e,n){"use strict";e.exports=t("./is-implemented")()?Math.sign:t("./shim")},{"./is-implemented":21,"./shim":22}],21:[function(t,e,n){"use strict";e.exports=function(){var t=Math.sign;return"function"!=typeof t?!1:1===t(10)&&-1===t(-20)}},{}],22:[function(t,e,n){"use strict";e.exports=function(t){return t=Number(t),isNaN(t)||0===t?t:t>0?1:-1}},{}],23:[function(t,e,n){"use strict";var r=t("../math/sign"),o=Math.abs,i=Math.floor;e.exports=function(t){return isNaN(t)?0:(t=Number(t),0!==t&&isFinite(t)?r(t)*i(o(t)):t)}},{"../math/sign":20}],24:[function(t,e,n){"use strict";var r=t("./to-integer"),o=Math.max;e.exports=function(t){return o(0,r(t))}},{"./to-integer":23}],25:[function(t,e,n){"use strict";var r=t("./valid-callable"),o=t("./valid-value"),i=Function.prototype.bind,a=Function.prototype.call,s=Object.keys,u=Object.prototype.propertyIsEnumerable;e.exports=function(t,e){return function(n,c){var l,f=arguments[2],p=arguments[3];return n=Object(o(n)),r(c),l=s(n),p&&l.sort("function"==typeof p?i.call(p,n):void 0),"function"!=typeof t&&(t=l[t]),a.call(t,l,function(t,r){return u.call(n,t)?a.call(c,f,n[t],t,n,r):e})}}},{"./valid-callable":42,"./valid-value":43}],26:[function(t,e,n){"use strict";e.exports=t("./is-implemented")()?Object.assign:t("./shim")},{"./is-implemented":27,"./shim":28}],27:[function(t,e,n){"use strict";e.exports=function(){var t,e=Object.assign;return"function"!=typeof e?!1:(t={foo:"raz"},e(t,{bar:"dwa"},{trzy:"trzy"}),t.foo+t.bar+t.trzy==="razdwatrzy")}},{}],28:[function(t,e,n){"use strict";var r=t("../keys"),o=t("../valid-value"),i=Math.max;e.exports=function(t,e){var n,a,s,u=i(arguments.length,2);for(t=Object(o(t)),s=function(r){try{t[r]=e[r]}catch(o){n||(n=o)}},a=1;u>a;++a)e=arguments[a],r(e).forEach(s);if(void 0!==n)throw n;return t}},{"../keys":34,"../valid-value":43}],29:[function(t,e,n){"use strict";var r=t("./assign"),o=t("./valid-value");e.exports=function(t){var e=Object(o(t));return e!==t?e:r({},t)}},{"./assign":26,"./valid-value":43}],30:[function(t,e,n){"use strict";var r,o=Object.create;t("./set-prototype-of/is-implemented")()||(r=t("./set-prototype-of/shim")),e.exports=function(){var t,e,n;return r?1!==r.level?o:(t={},e={},n={configurable:!1,enumerable:!1,writable:!0,value:void 0},Object.getOwnPropertyNames(Object.prototype).forEach(function(t){return"__proto__"===t?void(e[t]={configurable:!0,enumerable:!1,writable:!0,value:void 0}):void(e[t]=n)}),Object.defineProperties(t,e),Object.defineProperty(r,"nullPolyfill",{configurable:!1,enumerable:!1,writable:!1,value:t}),function(e,n){return o(null===e?t:e,n)}):o}()},{"./set-prototype-of/is-implemented":40,"./set-prototype-of/shim":41}],31:[function(t,e,n){"use strict";e.exports=t("./_iterate")("forEach")},{"./_iterate":25}],32:[function(t,e,n){"use strict";e.exports=function(t){return"function"==typeof t}},{}],33:[function(t,e,n){"use strict";var r={"function":!0,object:!0};e.exports=function(t){return null!=t&&r[typeof t]||!1}},{}],34:[function(t,e,n){"use strict";e.exports=t("./is-implemented")()?Object.keys:t("./shim")},{"./is-implemented":35,"./shim":36}],35:[function(t,e,n){"use strict";e.exports=function(){try{return Object.keys("primitive"),!0}catch(t){return!1}}},{}],36:[function(t,e,n){"use strict";var r=Object.keys;e.exports=function(t){return r(null==t?t:Object(t))}},{}],37:[function(t,e,n){"use strict";var r=t("./valid-callable"),o=t("./for-each"),i=Function.prototype.call;e.exports=function(t,e){var n={},a=arguments[2];return r(e),o(t,function(t,r,o,s){n[r]=i.call(e,a,t,r,o,s)}),n}},{"./for-each":31,"./valid-callable":42}],38:[function(t,e,n){"use strict";var r=Array.prototype.forEach,o=Object.create,i=function(t,e){var n;for(n in t)e[n]=t[n]};e.exports=function(t){var e=o(null);return r.call(arguments,function(t){null!=t&&i(Object(t),e)}),e}},{}],39:[function(t,e,n){"use strict";e.exports=t("./is-implemented")()?Object.setPrototypeOf:t("./shim")},{"./is-implemented":40,"./shim":41}],40:[function(t,e,n){"use strict";var r=Object.create,o=Object.getPrototypeOf,i={};e.exports=function(){var t=Object.setPrototypeOf,e=arguments[0]||r;return"function"!=typeof t?!1:o(t(e(null),i))===i}},{}],41:[function(t,e,n){"use strict";var r,o=t("../is-object"),i=t("../valid-value"),a=Object.prototype.isPrototypeOf,s=Object.defineProperty,u={configurable:!0,enumerable:!1,writable:!0,value:void 0};r=function(t,e){if(i(t),null===e||o(e))return t;throw new TypeError("Prototype must be null or an object")},e.exports=function(t){var e,n;return t?(2===t.level?t.set?(n=t.set,e=function(t,e){return n.call(r(t,e),e),t}):e=function(t,e){return r(t,e).__proto__=e,t}:e=function o(t,e){var n;return r(t,e),n=a.call(o.nullPolyfill,t),n&&delete o.nullPolyfill.__proto__,null===e&&(e=o.nullPolyfill),t.__proto__=e,n&&s(o.nullPolyfill,"__proto__",u),t},Object.defineProperty(e,"level",{configurable:!1,enumerable:!1,writable:!1,value:t.level})):null}(function(){var t,e=Object.create(null),n={},r=Object.getOwnPropertyDescriptor(Object.prototype,"__proto__");if(r){try{t=r.set,t.call(e,n)}catch(o){}if(Object.getPrototypeOf(e)===n)return{set:t,level:2}}return e.__proto__=n,Object.getPrototypeOf(e)===n?{level:2}:(e={},e.__proto__=n,Object.getPrototypeOf(e)===n?{level:1}:!1)}()),t("../create")},{"../create":30,"../is-object":33,"../valid-value":43}],42:[function(t,e,n){"use strict";e.exports=function(t){if("function"!=typeof t)throw new TypeError(t+" is not a function");return t}},{}],43:[function(t,e,n){"use strict";e.exports=function(t){if(null==t)throw new TypeError("Cannot use null or undefined");return t}},{}],44:[function(t,e,n){"use strict";e.exports=t("./is-implemented")()?String.prototype.contains:t("./shim")},{"./is-implemented":45,"./shim":46}],45:[function(t,e,n){"use strict";var r="razdwatrzy";e.exports=function(){return"function"!=typeof r.contains?!1:r.contains("dwa")===!0&&r.contains("foo")===!1}},{}],46:[function(t,e,n){"use strict";var r=String.prototype.indexOf;e.exports=function(t){return r.call(this,t,arguments[1])>-1}},{}],47:[function(t,e,n){"use strict";var r=Object.prototype.toString,o=r.call("");e.exports=function(t){return"string"==typeof t||t&&"object"==typeof t&&(t instanceof String||r.call(t)===o)||!1}},{}],48:[function(t,e,n){"use strict";var r,o=t("es5-ext/object/set-prototype-of"),i=t("es5-ext/string/#/contains"),a=t("d"),s=t("./"),u=Object.defineProperty;r=e.exports=function(t,e){return this instanceof r?(s.call(this,t),e=e?i.call(e,"key+value")?"key+value":i.call(e,"key")?"key":"value":"value",void u(this,"__kind__",a("",e))):new r(t,e)},o&&o(r,s),r.prototype=Object.create(s.prototype,{constructor:a(r),_resolve:a(function(t){return"value"===this.__kind__?this.__list__[t]:"key+value"===this.__kind__?[t,this.__list__[t]]:t}),toString:a(function(){return"[object Array Iterator]"})})},{"./":51,d:15,"es5-ext/object/set-prototype-of":39,"es5-ext/string/#/contains":44}],49:[function(t,e,n){"use strict";var r=t("es5-ext/function/is-arguments"),o=t("es5-ext/object/valid-callable"),i=t("es5-ext/string/is-string"),a=t("./get"),s=Array.isArray,u=Function.prototype.call,c=Array.prototype.some;e.exports=function(t,e){var n,l,f,p,h,d,m,g,y=arguments[2];if(s(t)||r(t)?n="array":i(t)?n="string":t=a(t),o(e),f=function(){p=!0},"array"===n)return void c.call(t,function(t){return u.call(e,y,t,f),p?!0:void 0});if("string"!==n)for(l=t.next();!l.done;){if(u.call(e,y,l.value,f),p)return;l=t.next()}else for(d=t.length,h=0;d>h&&(m=t[h],d>h+1&&(g=m.charCodeAt(0),g>=55296&&56319>=g&&(m+=t[++h])),u.call(e,y,m,f),!p);++h);}},{"./get":50,"es5-ext/function/is-arguments":18,"es5-ext/object/valid-callable":42,"es5-ext/string/is-string":47}],50:[function(t,e,n){"use strict";var r=t("es5-ext/function/is-arguments"),o=t("es5-ext/string/is-string"),i=t("./array"),a=t("./string"),s=t("./valid-iterable"),u=t("es6-symbol").iterator;e.exports=function(t){return"function"==typeof s(t)[u]?t[u]():r(t)?new i(t):o(t)?new a(t):new i(t)}},{"./array":48,"./string":53,"./valid-iterable":54,"es5-ext/function/is-arguments":18,"es5-ext/string/is-string":47,"es6-symbol":61}],51:[function(t,e,n){"use strict";var r,o=t("es5-ext/array/#/clear"),i=t("es5-ext/object/assign"),a=t("es5-ext/object/valid-callable"),s=t("es5-ext/object/valid-value"),u=t("d"),c=t("d/auto-bind"),l=t("es6-symbol"),f=Object.defineProperty,p=Object.defineProperties;e.exports=r=function(t,e){return this instanceof r?(p(this,{__list__:u("w",s(t)),__context__:u("w",e),__nextIndex__:u("w",0)}),void(e&&(a(e.on),e.on("_add",this._onAdd),e.on("_delete",this._onDelete),e.on("_clear",this._onClear)))):new r(t,e)},p(r.prototype,i({constructor:u(r),_next:u(function(){var t;if(this.__list__)return this.__redo__&&(t=this.__redo__.shift(),void 0!==t)?t:this.__nextIndex__<this.__list__.length?this.__nextIndex__++:void this._unBind()}),next:u(function(){return this._createResult(this._next())}),_createResult:u(function(t){return void 0===t?{done:!0,value:void 0}:{done:!1,value:this._resolve(t)}}),_resolve:u(function(t){return this.__list__[t]}),_unBind:u(function(){this.__list__=null,delete this.__redo__,this.__context__&&(this.__context__.off("_add",this._onAdd),this.__context__.off("_delete",this._onDelete),this.__context__.off("_clear",this._onClear),this.__context__=null)}),toString:u(function(){return"[object Iterator]"})},c({_onAdd:u(function(t){if(!(t>=this.__nextIndex__)){if(++this.__nextIndex__,!this.__redo__)return void f(this,"__redo__",u("c",[t]));this.__redo__.forEach(function(e,n){e>=t&&(this.__redo__[n]=++e)},this),this.__redo__.push(t)}}),_onDelete:u(function(t){var e;t>=this.__nextIndex__||(--this.__nextIndex__,this.__redo__&&(e=this.__redo__.indexOf(t),-1!==e&&this.__redo__.splice(e,1),this.__redo__.forEach(function(e,n){e>t&&(this.__redo__[n]=--e)},this)))}),_onClear:u(function(){this.__redo__&&o.call(this.__redo__),this.__nextIndex__=0})}))),f(r.prototype,l.iterator,u(function(){return this})),f(r.prototype,l.toStringTag,u("","Iterator"))},{d:15,"d/auto-bind":14,"es5-ext/array/#/clear":16,"es5-ext/object/assign":26,"es5-ext/object/valid-callable":42,"es5-ext/object/valid-value":43,"es6-symbol":61}],52:[function(t,e,n){"use strict";var r=t("es5-ext/function/is-arguments"),o=t("es5-ext/string/is-string"),i=t("es6-symbol").iterator,a=Array.isArray;e.exports=function(t){return null==t?!1:a(t)?!0:o(t)?!0:r(t)?!0:"function"==typeof t[i]}},{"es5-ext/function/is-arguments":18,"es5-ext/string/is-string":47,"es6-symbol":61}],53:[function(t,e,n){"use strict";var r,o=t("es5-ext/object/set-prototype-of"),i=t("d"),a=t("./"),s=Object.defineProperty;r=e.exports=function(t){return this instanceof r?(t=String(t),a.call(this,t),void s(this,"__length__",i("",t.length))):new r(t)},o&&o(r,a),r.prototype=Object.create(a.prototype,{constructor:i(r),_next:i(function(){return this.__list__?this.__nextIndex__<this.__length__?this.__nextIndex__++:void this._unBind():void 0}),_resolve:i(function(t){var e,n=this.__list__[t];return this.__nextIndex__===this.__length__?n:(e=n.charCodeAt(0),e>=55296&&56319>=e?n+this.__list__[this.__nextIndex__++]:n)}),toString:i(function(){return"[object String Iterator]"})})},{"./":51,d:15,"es5-ext/object/set-prototype-of":39}],54:[function(t,e,n){"use strict";var r=t("./is-iterable");e.exports=function(t){if(!r(t))throw new TypeError(t+" is not iterable");return t}},{"./is-iterable":52}],55:[function(t,e,n){(function(n,r){(function(){"use strict";function o(t){return"function"==typeof t||"object"==typeof t&&null!==t}function i(t){return"function"==typeof t}function a(t){return"object"==typeof t&&null!==t}function s(t){q=t}function u(t){X=t}function c(){return function(){n.nextTick(d)}}function l(){return function(){U(d)}}function f(){var t=0,e=new Q(d),n=document.createTextNode("");return e.observe(n,{characterData:!0}),function(){n.data=t=++t%2}}function p(){var t=new MessageChannel;return t.port1.onmessage=d,function(){t.port2.postMessage(0)}}function h(){return function(){setTimeout(d,1)}}function d(){for(var t=0;Z>t;t+=2){var e=et[t],n=et[t+1];e(n),et[t]=void 0,et[t+1]=void 0}Z=0}function m(){try{var e=t,n=e("vertx");return U=n.runOnLoop||n.runOnContext,l()}catch(r){return h()}}function g(){}function y(){return new TypeError("You cannot resolve a promise with itself")}function v(){return new TypeError("A promises callback cannot return that same promise.")}function _(t){try{return t.then}catch(e){return it.error=e,it}}function b(t,e,n,r){try{t.call(e,n,r)}catch(o){return o}}function x(t,e,n){X(function(t){var r=!1,o=b(n,e,function(n){r||(r=!0,e!==n?O(t,n):k(t,n))},function(e){r||(r=!0,E(t,e))},"Settle: "+(t._label||" unknown promise"));!r&&o&&(r=!0,E(t,o))},t)}function w(t,e){e._state===rt?k(t,e._result):e._state===ot?E(t,e._result):L(e,void 0,function(e){O(t,e)},function(e){E(t,e)})}function S(t,e){if(e.constructor===t.constructor)w(t,e);else{var n=_(e);n===it?E(t,it.error):void 0===n?k(t,e):i(n)?x(t,e,n):k(t,e)}}function O(t,e){t===e?E(t,y()):o(e)?S(t,e):k(t,e)}function j(t){t._onerror&&t._onerror(t._result),P(t)}function k(t,e){t._state===nt&&(t._result=e,t._state=rt,0!==t._subscribers.length&&X(P,t))}function E(t,e){t._state===nt&&(t._state=ot,t._result=e,X(j,t))}function L(t,e,n,r){var o=t._subscribers,i=o.length;t._onerror=null,o[i]=e,o[i+rt]=n,o[i+ot]=r,0===i&&t._state&&X(P,t)}function P(t){var e=t._subscribers,n=t._state;if(0!==e.length){for(var r,o,i=t._result,a=0;a<e.length;a+=3)r=e[a],o=e[a+n],r?M(n,r,o,i):o(i);t._subscribers.length=0}}function T(){this.error=null}function C(t,e){try{return t(e)}catch(n){return at.error=n,at}}function M(t,e,n,r){var o,a,s,u,c=i(n);if(c){if(o=C(n,r),o===at?(u=!0,a=o.error,o=null):s=!0,e===o)return void E(e,v())}else o=r,s=!0;e._state!==nt||(c&&s?O(e,o):u?E(e,a):t===rt?k(e,o):t===ot&&E(e,o))}function A(t,e){try{e(function(e){O(t,e)},function(e){E(t,e)})}catch(n){E(t,n)}}function B(t,e){var n=this;n._instanceConstructor=t,n.promise=new t(g),n._validateInput(e)?(n._input=e,n.length=e.length,n._remaining=e.length,n._init(),0===n.length?k(n.promise,n._result):(n.length=n.length||0,n._enumerate(),0===n._remaining&&k(n.promise,n._result))):E(n.promise,n._validationError())}function I(t){return new st(this,t).promise}function G(t){function e(t){O(o,t)}function n(t){E(o,t)}var r=this,o=new r(g);if(!Y(t))return E(o,new TypeError("You must pass an array to race.")),o;for(var i=t.length,a=0;o._state===nt&&i>a;a++)L(r.resolve(t[a]),void 0,e,n);return o}function N(t){var e=this;if(t&&"object"==typeof t&&t.constructor===e)return t;var n=new e(g);return O(n,t),n}function D(t){var e=this,n=new e(g);return E(n,t),n}function z(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}function V(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}function F(t){this._id=pt++,this._state=void 0,this._result=void 0,this._subscribers=[],g!==t&&(i(t)||z(),this instanceof F||V(),A(this,t))}function R(){var t;if("undefined"!=typeof r)t=r;else if("undefined"!=typeof self)t=self;else try{t=Function("return this")()}catch(e){throw new Error("polyfill failed because global object is unavailable in this environment")}var n=t.Promise;(!n||"[object Promise]"!==Object.prototype.toString.call(n.resolve())||n.cast)&&(t.Promise=ht)}var W;W=Array.isArray?Array.isArray:function(t){return"[object Array]"===Object.prototype.toString.call(t)};var U,q,H,Y=W,Z=0,X=({}.toString,function(t,e){et[Z]=t,et[Z+1]=e,Z+=2,2===Z&&(q?q(d):H())}),K="undefined"!=typeof window?window:void 0,J=K||{},Q=J.MutationObserver||J.WebKitMutationObserver,$="undefined"!=typeof n&&"[object process]"==={}.toString.call(n),tt="undefined"!=typeof Uint8ClampedArray&&"undefined"!=typeof importScripts&&"undefined"!=typeof MessageChannel,et=new Array(1e3);H=$?c():Q?f():tt?p():void 0===K&&"function"==typeof t?m():h();var nt=void 0,rt=1,ot=2,it=new T,at=new T;B.prototype._validateInput=function(t){return Y(t)},B.prototype._validationError=function(){return new Error("Array Methods must be provided an Array")},B.prototype._init=function(){this._result=new Array(this.length)};var st=B;B.prototype._enumerate=function(){for(var t=this,e=t.length,n=t.promise,r=t._input,o=0;n._state===nt&&e>o;o++)t._eachEntry(r[o],o)},B.prototype._eachEntry=function(t,e){var n=this,r=n._instanceConstructor;a(t)?t.constructor===r&&t._state!==nt?(t._onerror=null,n._settledAt(t._state,e,t._result)):n._willSettleAt(r.resolve(t),e):(n._remaining--,n._result[e]=t)},B.prototype._settledAt=function(t,e,n){var r=this,o=r.promise;o._state===nt&&(r._remaining--,t===ot?E(o,n):r._result[e]=n),0===r._remaining&&k(o,r._result)},B.prototype._willSettleAt=function(t,e){var n=this;L(t,void 0,function(t){n._settledAt(rt,e,t)},function(t){n._settledAt(ot,e,t)})};var ut=I,ct=G,lt=N,ft=D,pt=0,ht=F;F.all=ut,F.race=ct,F.resolve=lt,F.reject=ft,F._setScheduler=s,F._setAsap=u,F._asap=X,F.prototype={constructor:F,then:function(t,e){var n=this,r=n._state;if(r===rt&&!t||r===ot&&!e)return this;var o=new this.constructor(g),i=n._result;if(r){var a=arguments[r-1];X(function(){M(r,o,a,i)})}else L(n,o,t,e);return o},"catch":function(t){return this.then(null,t)}};var dt=R,mt={Promise:ht,polyfill:dt};"function"==typeof define&&define.amd?define(function(){return mt}):"undefined"!=typeof e&&e.exports?e.exports=mt:"undefined"!=typeof this&&(this.ES6Promise=mt),dt()}).call(this)}).call(this,t("_process"),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{_process:1}],56:[function(t,e,n){"use strict";t("./is-implemented")()||Object.defineProperty(t("es5-ext/global"),"Set",{value:t("./polyfill"),configurable:!0,enumerable:!1,writable:!0})},{"./is-implemented":57,"./polyfill":60,"es5-ext/global":19}],57:[function(t,e,n){"use strict";e.exports=function(){var t,e,n;return"function"!=typeof Set?!1:"[object Set]"!==String(Set.prototype)?!1:(t=new Set(["raz","dwa","trzy"]),3!==t.size?!1:"function"!=typeof t.add?!1:"function"!=typeof t.clear?!1:"function"!=typeof t["delete"]?!1:"function"!=typeof t.entries?!1:"function"!=typeof t.forEach?!1:"function"!=typeof t.has?!1:"function"!=typeof t.keys?!1:"function"!=typeof t.values?!1:(e=t.values(),n=e.next(),n.done!==!1?!1:"raz"!==n.value?!1:!0))}},{}],58:[function(t,e,n){"use strict";e.exports=function(){return"undefined"==typeof Set?!1:"[object Set]"===Object.prototype.toString.call(Set.prototype)}()},{}],59:[function(t,e,n){"use strict";var r,o=t("es5-ext/object/set-prototype-of"),i=t("es5-ext/string/#/contains"),a=t("d"),s=t("es6-iterator"),u=t("es6-symbol").toStringTag,c=Object.defineProperty;r=e.exports=function(t,e){return this instanceof r?(s.call(this,t.__setData__,t),e=e&&i.call(e,"key+value")?"key+value":"value",void c(this,"__kind__",a("",e))):new r(t,e)},o&&o(r,s),r.prototype=Object.create(s.prototype,{constructor:a(r),_resolve:a(function(t){return"value"===this.__kind__?this.__list__[t]:[this.__list__[t],this.__list__[t]]}),toString:a(function(){return"[object Set Iterator]"})}),c(r.prototype,u,a("c","Set Iterator"))},{d:15,"es5-ext/object/set-prototype-of":39,"es5-ext/string/#/contains":44,"es6-iterator":51,"es6-symbol":61}],60:[function(t,e,n){"use strict";var r,o,i=t("es5-ext/array/#/clear"),a=t("es5-ext/array/#/e-index-of"),s=t("es5-ext/object/set-prototype-of"),u=t("es5-ext/object/valid-callable"),c=t("d"),l=t("event-emitter"),f=t("es6-symbol"),p=t("es6-iterator/valid-iterable"),h=t("es6-iterator/for-of"),d=t("./lib/iterator"),m=t("./is-native-implemented"),g=Function.prototype.call,y=Object.defineProperty,v=Object.getPrototypeOf;e.exports=r=function(){var t,e=arguments[0];if(!(this instanceof r))throw new TypeError("Constructor requires 'new'");return t=m&&s?s(new Set,v(this)):this,null!=e&&p(e),y(t,"__setData__",c("c",[])),e?(h(e,function(t){-1===a.call(this,t)&&this.push(t)},t.__setData__),t):t},m&&(s&&s(r,Set),r.prototype=Object.create(Set.prototype,{constructor:c(r)})),l(Object.defineProperties(r.prototype,{add:c(function(t){return this.has(t)?this:(this.emit("_add",this.__setData__.push(t)-1,t),this)}),clear:c(function(){this.__setData__.length&&(i.call(this.__setData__),this.emit("_clear"))}),"delete":c(function(t){var e=a.call(this.__setData__,t);return-1===e?!1:(this.__setData__.splice(e,1),this.emit("_delete",e,t),!0)}),entries:c(function(){return new d(this,"key+value")}),forEach:c(function(t){var e,n,r,o=arguments[1];for(u(t),e=this.values(),n=e._next();void 0!==n;)r=e._resolve(n),g.call(t,o,r,r,this),n=e._next()}),has:c(function(t){return-1!==a.call(this.__setData__,t)}),keys:c(o=function(){return this.values()}),size:c.gs(function(){return this.__setData__.length}),values:c(function(){return new d(this)}),toString:c(function(){return"[object Set]"})})),y(r.prototype,f.iterator,c(o)),y(r.prototype,f.toStringTag,c("c","Set"))},{"./is-native-implemented":58,"./lib/iterator":59,d:15,"es5-ext/array/#/clear":16,"es5-ext/array/#/e-index-of":17,"es5-ext/object/set-prototype-of":39,"es5-ext/object/valid-callable":42,"es6-iterator/for-of":49,"es6-iterator/valid-iterable":54,"es6-symbol":61,"event-emitter":66}],61:[function(t,e,n){"use strict";e.exports=t("./is-implemented")()?Symbol:t("./polyfill")},{"./is-implemented":62,"./polyfill":64}],62:[function(t,e,n){"use strict";e.exports=function(){var t;if("function"!=typeof Symbol)return!1;t=Symbol("test symbol");try{String(t)}catch(e){return!1}return"symbol"==typeof Symbol.iterator?!0:"object"!=typeof Symbol.isConcatSpreadable?!1:"object"!=typeof Symbol.iterator?!1:"object"!=typeof Symbol.toPrimitive?!1:"object"!=typeof Symbol.toStringTag?!1:"object"!=typeof Symbol.unscopables?!1:!0}},{}],63:[function(t,e,n){"use strict";e.exports=function(t){return t&&("symbol"==typeof t||"Symbol"===t["@@toStringTag"])||!1}},{}],64:[function(t,e,n){"use strict";var r,o,i,a=t("d"),s=t("./validate-symbol"),u=Object.create,c=Object.defineProperties,l=Object.defineProperty,f=Object.prototype,p=u(null);"function"==typeof Symbol&&(r=Symbol);var h=function(){var t=u(null);return function(e){for(var n,r,o=0;t[e+(o||"")];)++o;return e+=o||"",t[e]=!0,n="@@"+e,l(f,n,a.gs(null,function(t){r||(r=!0,l(this,n,a(t)),r=!1)})),n}}();i=function(t){if(this instanceof i)throw new TypeError("TypeError: Symbol is not a constructor");return o(t)},e.exports=o=function d(t){var e;if(this instanceof d)throw new TypeError("TypeError: Symbol is not a constructor");return e=u(i.prototype),t=void 0===t?"":String(t),c(e,{__description__:a("",t),__name__:a("",h(t))})},c(o,{"for":a(function(t){return p[t]?p[t]:p[t]=o(String(t))}),keyFor:a(function(t){var e;s(t);for(e in p)if(p[e]===t)return e;
}),hasInstance:a("",r&&r.hasInstance||o("hasInstance")),isConcatSpreadable:a("",r&&r.isConcatSpreadable||o("isConcatSpreadable")),iterator:a("",r&&r.iterator||o("iterator")),match:a("",r&&r.match||o("match")),replace:a("",r&&r.replace||o("replace")),search:a("",r&&r.search||o("search")),species:a("",r&&r.species||o("species")),split:a("",r&&r.split||o("split")),toPrimitive:a("",r&&r.toPrimitive||o("toPrimitive")),toStringTag:a("",r&&r.toStringTag||o("toStringTag")),unscopables:a("",r&&r.unscopables||o("unscopables"))}),c(i.prototype,{constructor:a(o),toString:a("",function(){return this.__name__})}),c(o.prototype,{toString:a(function(){return"Symbol ("+s(this).__description__+")"}),valueOf:a(function(){return s(this)})}),l(o.prototype,o.toPrimitive,a("",function(){return s(this)})),l(o.prototype,o.toStringTag,a("c","Symbol")),l(i.prototype,o.toPrimitive,a("c",o.prototype[o.toPrimitive])),l(i.prototype,o.toStringTag,a("c",o.prototype[o.toStringTag]))},{"./validate-symbol":65,d:15}],65:[function(t,e,n){"use strict";var r=t("./is-symbol");e.exports=function(t){if(!r(t))throw new TypeError(t+" is not a symbol");return t}},{"./is-symbol":63}],66:[function(t,e,n){"use strict";var r,o,i,a,s,u,c,l=t("d"),f=t("es5-ext/object/valid-callable"),p=Function.prototype.apply,h=Function.prototype.call,d=Object.create,m=Object.defineProperty,g=Object.defineProperties,y=Object.prototype.hasOwnProperty,v={configurable:!0,enumerable:!1,writable:!0};r=function(t,e){var n;return f(e),y.call(this,"__ee__")?n=this.__ee__:(n=v.value=d(null),m(this,"__ee__",v),v.value=null),n[t]?"object"==typeof n[t]?n[t].push(e):n[t]=[n[t],e]:n[t]=e,this},o=function(t,e){var n,o;return f(e),o=this,r.call(this,t,n=function(){i.call(o,t,n),p.call(e,this,arguments)}),n.__eeOnceListener__=e,this},i=function(t,e){var n,r,o,i;if(f(e),!y.call(this,"__ee__"))return this;if(n=this.__ee__,!n[t])return this;if(r=n[t],"object"==typeof r)for(i=0;o=r[i];++i)(o===e||o.__eeOnceListener__===e)&&(2===r.length?n[t]=r[i?0:1]:r.splice(i,1));else(r===e||r.__eeOnceListener__===e)&&delete n[t];return this},a=function(t){var e,n,r,o,i;if(y.call(this,"__ee__")&&(o=this.__ee__[t]))if("object"==typeof o){for(n=arguments.length,i=new Array(n-1),e=1;n>e;++e)i[e-1]=arguments[e];for(o=o.slice(),e=0;r=o[e];++e)p.call(r,this,i)}else switch(arguments.length){case 1:h.call(o,this);break;case 2:h.call(o,this,arguments[1]);break;case 3:h.call(o,this,arguments[1],arguments[2]);break;default:for(n=arguments.length,i=new Array(n-1),e=1;n>e;++e)i[e-1]=arguments[e];p.call(o,this,i)}},s={on:r,once:o,off:i,emit:a},u={on:l(r),once:l(o),off:l(i),emit:l(a)},c=g({},u),e.exports=n=function(t){return null==t?d(c):g(Object(t),u)},n.methods=s},{d:15,"es5-ext/object/valid-callable":42}],67:[function(t,e,n){"use strict";function r(t,e){if(""===t||""===e||t.length!==e.length)return!1;for(var n=0,r=0,o=0,i=0;r<t.length&&o<e.length;++r,++o)if(t[r]!=e[o]){if(++i>1)return!1;t[r+1]===e[o]?++r:t[r]===e[o+1]?++o:t[r+1]===e[o+1]&&(++r,++o)}return 1===n}function o(){return(navigator.userLanguage||navigator.language).slice(0,2).toLowerCase()}function i(t){var e=t.match(/translate(3d)?\((-?\d+).*?,\s?(-?\d+).*?(,\s?(-?\d+).*?)?\)/i);return e?new b.Point(Number(e[2]),Number(e[3])):new b.Point(0,0)}function a(t,e){if(3!==e.platforms.length)return null;var n=e.platforms.map(function(e){return t.platforms[e]});return n.every(function(t){return 2===t.transfers.length})?n:null}function s(t){if(3!==t.length)throw new Error("must have 3 vertices");var e=t[1].subtract(t[0]),n=t[2].subtract(t[0]),r=f(e,e),o=f(n,n);return new b.Point(n.y*r-e.y*o,e.x*o-n.x*r).divideBy(2*(e.x*n.y-e.y*n.x)).add(t[0])}function u(t){if("dataset"in t)return t.dataset;for(var e=t.attributes,n={},r=0;r<e.length;++r){var o=e[r].name;o.startsWith("data-")&&(n[o.slice(5)]=t.getAttribute(o))}return n}function c(t,e){for(var n=0,r=Object.keys(e);n<r.length;n++){var o=r[n];t.setAttribute("data-"+o,e[o])}}function l(t,e){var n=0;setInterval(function(){return document.title=t[++n%t.length]},e)}function f(t,e){return t.x*e.x+t.y*e.y}function p(t,e){return f(t,e)/t.distanceTo(e)}function h(t){return t.reduce(function(t,e){return t.add(e)}).divideBy(t.length)}function d(t,e,n){return new b.Point(t.x+e*Math.cos(n),t.y+e*Math.sin(n))}function m(t,e){function n(e){if(void 0===t.platforms.find(function(t){return t.name===e}))throw new Error("platform "+e+" doesn't exist")}function r(t){for(var e=0,r=Object.keys(t);e<r.length;e++){var o=r[e],i=t[o];"string"==typeof i?n(i):i.forEach(n)}}return new Promise(function(n,o){var i=e.crossPlatform;Object.keys(i).forEach(function(e){void 0===t.platforms.find(function(t){return t.name===e})&&o("platform "+e+" doesn't exist");var n=i[e];"forEach"in n?n.forEach(r):r(n)}),n("hints json seems okay")})}function g(t,e,n){var r=n.spans.map(function(e){return t.spans[e]}),o=[];r.forEach(function(e){return e.routes.forEach(function(e){return o.push(t.routes[e])})});var i=o.map(function(t){return t.line}),a=e[n.name];if(a)if("forEach"in a){for(var s=0;s<a.length;++s)if(Object.keys(a[s]).some(function(t){return i.indexOf(t)>-1}))return s}else if(Object.keys(a).some(function(t){return i.indexOf(t)>-1}))return-1;return null}function y(t,e){var n=document.createElement("a"),r=new Blob([e],{type:"octet/stream"}),o=window.URL.createObjectURL(r);n.href=o,n.download=t,n.click(),window.URL.revokeObjectURL(o)}function v(t){var e=Math.abs(t.x),n=Math.abs(t.y);return t.divideBy(n>e?n:e)}function _(t,e,n){var r=e*e/n;return t>r?e/n*2+(t-r)/e:2*Math.sqrt(t/n)}var b=window.L;n.diffByOne=r,n.getUserLanguage=o,n.parseTransform=i,n.findCircle=a,n.getCircumcenter=s,n.getSVGDataset=u,n.setSVGDataset=c,n.flashTitle=l,n.dot=f,n.angle=p,n.getCenter=h,n.polarToCartesian=d,n.verifyHints=m,n.hintContainsLine=g,n.downloadAsFile=y,n.vectorToGradCoordinates=v,n.lineRules=function(){for(var t=document.styleSheets[2].cssRules,e={},n=0;n<t.length;++n){var r=t[n];if(r instanceof CSSStyleRule){var o=r.selectorText;if("#paths-outer .E"===o)e.E=r.style.stroke;else{var i=o.match(/\.(M\d+|L)/);i&&(e[i[1]]=r.style.stroke)}}}return e}(),n.timeToTravel=_},{}]},{},[6]);